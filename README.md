# InDelScanner: a collection of tools for detecting substitutions, insertions and deletions in Illumina sequencing data, and performing deep mutational scanning

What it does:
- A shell wrapper script 

## Setup and installation
### Alignment software
- samtools version 1.9
- htslib version 1.9
- bowtie2 version 2.3
- emboss version 6.6
The versions given here were used to process the data; compatibility with newer or older versions is unclear.
### Python and Conda dependencies
InDelScanner is a set of scripts that was developed and tested within the Anaconda tools. The environment is given in InDelScanner.yml. To install go to the InDelScanner directory and use:
```
conda create -f InDelScanner.yml
```
Then activate the environment with `source activate InDelScanner` or `conda activate InDelScanner`. The latter is preferred for conda v.4.4 or higher, but can be finicky.

#### Wrapper for multiple files
Collector.py takes dictionaries generated by running indels.py on multiple sequencing files.

#### Preprocessing
- If using paired end reads: merge reads with PEAR. Take the opportunity to filter out very broken data.
- Align all reads against reference.
- While we have SAM files, take the opportunity to calculate depth / position.
- Extract reads that are correctly mapped, keep the name.
- Throw away reads the fully match reference. This is faster than NW alignment for all reads later.
- Feed interesting reads to EMBOSS Needleman-Wunsch aligner. I trust it better than samtools to correctly position InDels.

#### Counting substitutions, deletions and combinations for each sequencing file
- Load a dictionary of all interesting mutations we're considering
- Read a read+reference into a SeqRecord
- Various checks that the read is not broken
    Barcodes: As long as the read does not contain insertions, the barcode is ignored and does not contribute to detected mutations
- If the mutation is defined as interesting, figure out what kind it is and add to valid_counts dictionary
- Add the mutation to a dictionary counting everything
- Save both dictionaries for later viewing.
